"use strict";(self.webpackChunkso=self.webpackChunkso||[]).push([[9560],{5680:(e,n,t)=>{t.d(n,{xA:()=>c,yg:()=>u});var a=t(6540);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var o=a.createContext({}),p=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(o.Provider,{value:n},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},g=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,l=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=p(t),g=i,u=m["".concat(o,".").concat(g)]||m[g]||d[g]||l;return t?a.createElement(u,r(r({ref:n},c),{},{components:t})):a.createElement(u,r({ref:n},c))}));function u(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var l=t.length,r=new Array(l);r[0]=g;var s={};for(var o in n)hasOwnProperty.call(n,o)&&(s[o]=n[o]);s.originalType=e,s[m]="string"==typeof e?e:i,r[1]=s;for(var p=2;p<l;p++)r[p]=t[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}g.displayName="MDXCreateElement"},2879:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>d,frontMatter:()=>l,metadata:()=>s,toc:()=>p});var a=t(8168),i=(t(6540),t(5680));const l={},r="Lab 2 - Library Perspective",s={unversionedId:"Software Stack/lab2",id:"Software Stack/lab2",title:"Lab 2 - Library Perspective",description:"Task: Common Functions",source:"@site/docs/Software Stack/lab2.md",sourceDirName:"Software Stack",slug:"/Software Stack/lab2",permalink:"/operating-systems/149/Software Stack/lab2",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"Lab 1 - Operating System Perspective",permalink:"/operating-systems/149/Software Stack/lab1"},next:{title:"Data",permalink:"/operating-systems/149/Data/"}},o={},p=[{value:"Task: Common Functions",id:"task-common-functions",level:2},{value:"Task: Libraries and libc",id:"task-libraries-and-libc",level:2},{value:"Task: High-Level Languages",id:"task-high-level-languages",level:2},{value:"Task: App Investigation",id:"task-app-investigation",level:2},{value:"Guide: Statically-linked and Dynamically-linked Libraries",id:"guide-statically-linked-and-dynamically-linked-libraries",level:2},{value:"Common Functions",id:"common-functions",level:2},{value:"Libraries and libc",id:"libraries-and-libc",level:2},{value:"High-Level Languages",id:"high-level-languages",level:2},{value:"App Investigation",id:"app-investigation",level:2}],c={toc:p},m="wrapper";function d(e){let{components:n,...t}=e;return(0,i.yg)(m,(0,a.A)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,i.yg)("h1",{id:"lab-2---library-perspective"},"Lab 2 - Library Perspective"),(0,i.yg)("h2",{id:"task-common-functions"},"Task: Common Functions"),(0,i.yg)("p",null,"Enter the ",(0,i.yg)("inlineCode",{parentName:"p"},"chapters/software-stack/libc/drills/tasks/common-functions/")," folder, run ",(0,i.yg)("inlineCode",{parentName:"p"},"make skels"),", then enter ",(0,i.yg)("inlineCode",{parentName:"p"},"support/"),".\nGo through the practice items below."),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Update ",(0,i.yg)("inlineCode",{parentName:"p"},"os_string.c")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"os_string.h")," to make available the ",(0,i.yg)("inlineCode",{parentName:"p"},"os_strcat()")," function that performs the same string concatenation as ",(0,i.yg)("inlineCode",{parentName:"p"},"strcat()")," from ",(0,i.yg)("inlineCode",{parentName:"p"},"libc"),".\nCheck your implementation by running ",(0,i.yg)("inlineCode",{parentName:"p"},"make check")," in ",(0,i.yg)("inlineCode",{parentName:"p"},"support/tests/"),".\nIf some of the tests fail, start debugging from the file that calls ",(0,i.yg)("inlineCode",{parentName:"p"},"os_strcat()"),": ",(0,i.yg)("inlineCode",{parentName:"p"},"test.c"),".")),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Update the ",(0,i.yg)("inlineCode",{parentName:"p"},"main_printf.c")," file to use the implementation of ",(0,i.yg)("inlineCode",{parentName:"p"},"sprintf()")," to collect information to be printed inside a buffer.\nCall the ",(0,i.yg)("inlineCode",{parentName:"p"},"write()")," function to print the information.\nThe ",(0,i.yg)("inlineCode",{parentName:"p"},"printf()")," function will no longer be called.\nThis results in a single ",(0,i.yg)("inlineCode",{parentName:"p"},"write()")," system call."),(0,i.yg)("p",{parentName:"li"},"Using previously implemented functions allows us to more efficiently write new programs.\nThese functions provide us with extensive features that we use in our programs."),(0,i.yg)("p",{parentName:"li"},(0,i.yg)("a",{parentName:"p",href:"Questions/printf-syscall"},"Quiz 1")),(0,i.yg)("p",{parentName:"li"},(0,i.yg)("a",{parentName:"p",href:"Questions/strcpy-syscall"},"Quiz 2")),(0,i.yg)("p",{parentName:"li"},(0,i.yg)("a",{parentName:"p",href:"Questions/printf-vs-write"},"Quiz 3"))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Update the ",(0,i.yg)("inlineCode",{parentName:"p"},"putchar()")," function in ",(0,i.yg)("inlineCode",{parentName:"p"},"main_printf.c")," to implement a buffered functionality of ",(0,i.yg)("inlineCode",{parentName:"p"},"printf()"),".\nCharacters passed via the ",(0,i.yg)("inlineCode",{parentName:"p"},"putchar()")," call will be stored in a predefined static global buffer.\nThe ",(0,i.yg)("inlineCode",{parentName:"p"},"write()")," call will be invoked when a newline is encountered or when the buffer is full.\nThis results in a reduced number of ",(0,i.yg)("inlineCode",{parentName:"p"},"write")," system calls.\nUse ",(0,i.yg)("inlineCode",{parentName:"p"},"strace")," to confirm the reduction of the number of ",(0,i.yg)("inlineCode",{parentName:"p"},"write")," system calls.")),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Update the ",(0,i.yg)("inlineCode",{parentName:"p"},"main_printf.c")," file to also feature a ",(0,i.yg)("inlineCode",{parentName:"p"},"flush()")," function that forces the flushing of the static global buffer and a ",(0,i.yg)("inlineCode",{parentName:"p"},"write")," system call.\nMake calls to ",(0,i.yg)("inlineCode",{parentName:"p"},"printf()")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"flush()")," to validate the implementation.\nUse ",(0,i.yg)("inlineCode",{parentName:"p"},"strace")," to inspect the ",(0,i.yg)("inlineCode",{parentName:"p"},"write()")," system calls invoked by ",(0,i.yg)("inlineCode",{parentName:"p"},"printf()")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"flush()"),"."))),(0,i.yg)("p",null,"If you're having difficulties solving this exercise, go through ",(0,i.yg)("a",{parentName:"p",href:"/operating-systems/149/Software%20Stack/lab2#common-functions"},"this")," reading material."),(0,i.yg)("h2",{id:"task-libraries-and-libc"},"Task: Libraries and libc"),(0,i.yg)("p",null,"Enter the ",(0,i.yg)("inlineCode",{parentName:"p"},"chapters/software-stack/libc/libc/drills/tasks/")," folder, run ",(0,i.yg)("inlineCode",{parentName:"p"},"make skels"),", then enter ",(0,i.yg)("inlineCode",{parentName:"p"},"support/"),".\nNow go through the practice items below."),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Use ",(0,i.yg)("inlineCode",{parentName:"p"},"malloc()")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"free()")," functions in the ",(0,i.yg)("inlineCode",{parentName:"p"},"memory.c")," program.\nMake your own use of the allocated memory."),(0,i.yg)("p",{parentName:"li"},"It's very easy to use memory management functions with the libc.\nThe alternative (without the libc) would be more cumbersome."),(0,i.yg)("p",{parentName:"li"},"Use different values for ",(0,i.yg)("inlineCode",{parentName:"p"},"malloc()"),", i.e. the allocation size.\nUse ",(0,i.yg)("inlineCode",{parentName:"p"},"strace")," to check the system calls invoked by ",(0,i.yg)("inlineCode",{parentName:"p"},"malloc()")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"free()"),".\nYou'll see that, depending on the size, the ",(0,i.yg)("inlineCode",{parentName:"p"},"brk()")," or ",(0,i.yg)("inlineCode",{parentName:"p"},"mmap()")," / ",(0,i.yg)("inlineCode",{parentName:"p"},"munmap()")," system calls are invoked.\nAnd for certain calls to ",(0,i.yg)("inlineCode",{parentName:"p"},"malloc()")," / ",(0,i.yg)("inlineCode",{parentName:"p"},"free()")," no syscall is happening.\nYou'll find more about them in the ",(0,i.yg)("a",{parentName:"p",href:"../../../data/lab"},"Data chapter"),"."),(0,i.yg)("p",{parentName:"li"},(0,i.yg)("a",{parentName:"p",href:"Questions/malloc"},"Quiz"))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Create your own C program with calls to the standard C library in ",(0,i.yg)("inlineCode",{parentName:"p"},"vendetta.c"),".\nBe as creative as you can about the types of functions being made."),(0,i.yg)("p",{parentName:"li"},(0,i.yg)("a",{parentName:"p",href:"Questions/libc"},"Quiz"))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Inside the ",(0,i.yg)("inlineCode",{parentName:"p"},"vendetta.c")," file make a call ",(0,i.yg)("inlineCode",{parentName:"p"},'open("a.txt", O_RDWR | O_CREAT, 0644)')," to open / create the ",(0,i.yg)("inlineCode",{parentName:"p"},"a.txt")," file.\nMake sure you include all required headers.\nCheck the system call being made."),(0,i.yg)("p",{parentName:"li"},"Make an ",(0,i.yg)("inlineCode",{parentName:"p"},"fopen()")," with the proper arguments that gets as close as possible to the ",(0,i.yg)("inlineCode",{parentName:"p"},"open()")," call, i.e. the system call arguments are as close as possible.")),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Inside the ",(0,i.yg)("inlineCode",{parentName:"p"},"vendetta.c")," file make a call to ",(0,i.yg)("inlineCode",{parentName:"p"},"sin()")," function (for sine).\nCompute ",(0,i.yg)("inlineCode",{parentName:"p"},"sin(0)")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"sin(PI/2)"),"."))),(0,i.yg)("p",null,"If you're having difficulties solving this exercise, go through ",(0,i.yg)("a",{parentName:"p",href:"/operating-systems/149/Software%20Stack/lab2#libraries-and-libc"},"this")," reading material."),(0,i.yg)("h2",{id:"task-high-level-languages"},"Task: High-Level Languages"),(0,i.yg)("p",null,"Enter the ",(0,i.yg)("inlineCode",{parentName:"p"},"chapters/software-stack/high-level-languages/drills/tasks/high-level-lang/")," folder, run ",(0,i.yg)("inlineCode",{parentName:"p"},"make skels"),", then enter ",(0,i.yg)("inlineCode",{parentName:"p"},"spport/"),"\nThen go through the practice items below."),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Use ",(0,i.yg)("inlineCode",{parentName:"p"},"make")," to create the ",(0,i.yg)("inlineCode",{parentName:"p"},"hello")," executable from the ",(0,i.yg)("inlineCode",{parentName:"p"},"hello.go"),' file (a Go "Hello, World!"-printing program).\nUse ',(0,i.yg)("inlineCode",{parentName:"p"},"ltrace")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"strace")," to compute the number of library calls and system calls.\nUse ",(0,i.yg)("inlineCode",{parentName:"p"},"perf")," to measure the running time."),(0,i.yg)("p",{parentName:"li"},'Compare the values with those from the "Hello, World!"-printing programs in C and Python.')),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},'Create a "Hello, World!"-printing program in a programming language of your choice (other than C, Python and Go).\nFind the values above (library calls, system calls and running time).'),(0,i.yg)("p",{parentName:"li"},(0,i.yg)("a",{parentName:"p",href:"Questions/python-tools"},"Quiz"))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Create programs in C, Python and Go that compute the N-th Fibonacci number.\n",(0,i.yg)("inlineCode",{parentName:"p"},"N")," is passed as a command-line argument.\nRun the checker (",(0,i.yg)("inlineCode",{parentName:"p"},"make check")," in the ",(0,i.yg)("inlineCode",{parentName:"p"},"high-level-lang/solution/tests/")," folder) to check your results."),(0,i.yg)("p",{parentName:"li"},"Use ",(0,i.yg)("inlineCode",{parentName:"p"},"ltrace")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"strace")," to compute the number of library calls and system calls.\nUse ",(0,i.yg)("inlineCode",{parentName:"p"},"perf")," to measure the running time."),(0,i.yg)("p",{parentName:"li"},"Compare the values of the three programs.")),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Create programs in C, Python and Go that copy a source file into a destination file.\nBoth files are passed as the two command-line arguments for the program.\nRun the checker (",(0,i.yg)("inlineCode",{parentName:"p"},"make check")," in the ",(0,i.yg)("inlineCode",{parentName:"p"},"high-level-lang/support/tests/")," folder) to check your results."),(0,i.yg)("p",{parentName:"li"},"Sample run:"),(0,i.yg)("pre",{parentName:"li"},(0,i.yg)("code",{parentName:"pre",className:"language-console"},"student@so:~/.../solution/tests/$ make check\nmake -C ../src\nmake[1]: Entering directory '/media/teo/1TB/Poli/Asistent/SO/operating-systems/chapters/software-stack/high-level-languages/drills/tasks/high-level-lang/solution/src'\ngo build -ldflags '-linkmode external -extldflags \"-dynamic\"' hello.go\ncc   -z lazy  fibo.c   -o fibo\ngo build -o fibo_go -ldflags '-linkmode external -extldflags \"-dynamic\"' fibo.go\ncc   -z lazy  copy.c   -o copy\ngo build -o copy_go -ldflags '-linkmode external -extldflags \"-dynamic\"' copy.go\nmake[1]: Leaving directory '/media/teo/1TB/Poli/Asistent/SO/operating-systems/chapters/software-stack/high-level-languages/drills/tasks/high-level-lang/solution/src'\nFibonacci [C]       --  fibo(10) ==   55  --  PASSED\nFibonacci [C]       --  fibo( 5) ==    5  --  PASSED\nFibonacci [C]       --  fibo(20) == 6765  --  PASSED\nFibonacci [Python]  --  fibo(10) ==   55  --  PASSED\nFibonacci [Python]  --  fibo( 5) ==    5  --  PASSED\nFibonacci [Python]  --  fibo(20) == 6765  --  PASSED\nFibonacci [Go]      --  fibo(10) ==   55  --  PASSED\nFibonacci [Go]      --  fibo( 5) ==    5  --  PASSED\nFibonacci [Go]      --  fibo(20) == 6765  --  PASSED\nCopy [C]            --  PASSED\nCopy [Python]       --  PASSED\nCopy [Go]           --  PASSED \n")),(0,i.yg)("p",{parentName:"li"},"Use ",(0,i.yg)("inlineCode",{parentName:"p"},"ltrace")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"strace")," to compute the number of library calls and system calls.\nUse ",(0,i.yg)("inlineCode",{parentName:"p"},"perf")," to measure the running time.\nUse source files of different sizes.\nCompare the outputs of these commands on the three programs."))),(0,i.yg)("p",null,"If you're having difficulties solving this exercise, go through ",(0,i.yg)("a",{parentName:"p",href:"/operating-systems/149/Software%20Stack/lab2#high-level-languages"},"this")," reading material."),(0,i.yg)("h2",{id:"task-app-investigation"},"Task: App Investigation"),(0,i.yg)("p",null,"Enter the ",(0,i.yg)("inlineCode",{parentName:"p"},"chapters/software-stack/applications/drills/tasks/app-investigation/support/")," folder and go through the practice items below.\nSelect a binary executable application and a scripted application."),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Use ",(0,i.yg)("inlineCode",{parentName:"p"},"ldd")," on the two applications.\nNotice the resulting messages and explain the results.")),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Use ",(0,i.yg)("inlineCode",{parentName:"p"},"ltrace")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"strace")," on the two applications.\nFollow the library calls and the system calls done by each application.")),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Check to see whether there are statically-linked application executables in the system.\nThe ",(0,i.yg)("inlineCode",{parentName:"p"},"file")," command tells if the file passed as argument is a statically-linked executable.\nIf you can't find one, install the ",(0,i.yg)("inlineCode",{parentName:"p"},"busybox-static")," package.")),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Look into what ",(0,i.yg)("a",{parentName:"p",href:"https://busybox.net/"},"busybox")," is and explain why it's custom to have it as statically-linked executable.")),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Run ",(0,i.yg)("inlineCode",{parentName:"p"},"ldd"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"nm"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"strace"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"ltrace")," on a statically-linked application executable.\nExplain the results."))),(0,i.yg)("p",null,"If you're having difficulties solving this exercise, go through ",(0,i.yg)("a",{parentName:"p",href:"/operating-systems/149/Software%20Stack/lab2#app-investigation"},"this")," reading material."),(0,i.yg)("h2",{id:"guide-statically-linked-and-dynamically-linked-libraries"},"Guide: Statically-linked and Dynamically-linked Libraries"),(0,i.yg)("p",null,"Libraries can be statically-linked or dynamically-linked, creating statically-linked executables and dynamically-linked executables.\nTypically, the executables found in modern operating systems are dynamically-linked, given their reduced size and ability to share libraries at runtime."),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"chapters/software-stack/libraries/guides/static-dynamic/support/"),' folder stores the implementation of a simple "Hello, World!"-printing program that uses both static and dynamic linking of libraries.\nLet\'s build and run the two executables:'),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},"student@os:~/.../static-dynamic/support$ ls\nhello.c  Makefile\n\nstudent@os:~/.../static-dynamic/support$ make\ncc -Wall   -c -o hello.o hello.c\ncc   hello.o   -o hello\ncc -static -o hello_static hello.o\n\nstudent@os:~/.../static-dynamic/support$ ls -lh\ntotal 852K\n-rwxrwxr-x 1 razvan razvan 8.2K Aug  2 15:53 hello\n-rw-rw-r-- 1 razvan razvan   76 Aug  2 15:51 hello.c\n-rw-rw-r-- 1 razvan razvan 1.6K Aug  2 15:53 hello.o\n-rwxrwxr-x 1 razvan razvan 827K Aug  2 15:53 hello_static\n-rw-rw-r-- 1 razvan razvan  237 Aug  2 15:53 Makefile\n\nstudent@os:~/.../static-dynamic/support$ ./hello\nHello, World!\n\nstudent@os:~/.../static-dynamic/support$ ./hello_static\nHello, World!\n")),(0,i.yg)("p",null,"The two executables (",(0,i.yg)("inlineCode",{parentName:"p"},"hello")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"hello_static"),") behave similarly, despite having vastly different sizes (",(0,i.yg)("inlineCode",{parentName:"p"},"8.2K")," vs. ",(0,i.yg)("inlineCode",{parentName:"p"},"827K")," - 100 times larger)."),(0,i.yg)("p",null,"We use ",(0,i.yg)("inlineCode",{parentName:"p"},"nm")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"ldd")," to catch differences between the two types of resulting executables:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},"student@os:~/.../static-dynamic/support$ ldd hello\n        linux-vdso.so.1 (0x00007ffc8d9b2000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f10d1d88000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f10d237b000)\n\nstudent@os:~/.../static-dynamic/support$ ldd hello_static\n        not a dynamic executable\n\nstudent@os:~/.../static-dynamic/support$ nm hello | wc -l\n33\n\nstudent@os:~/.../static-dynamic/support$ nm hello_static | wc -l\n1674\n")),(0,i.yg)("p",null,"The dynamic executable references the dynamically-linked libc library (",(0,i.yg)("inlineCode",{parentName:"p"},"/lib/x86_64-linux-gnu/libc.so.6"),"), while the statically-linked executable has no references.\nAlso, given the statically-linked executable integrated entire parts of statically-linked libraries, there are many more symbols than in the case of a dynamically-linked executable (",(0,i.yg)("inlineCode",{parentName:"p"},"1674")," vs. ",(0,i.yg)("inlineCode",{parentName:"p"},"33"),")."),(0,i.yg)("p",null,"We can use ",(0,i.yg)("inlineCode",{parentName:"p"},"strace")," to see that there are differences in the preparatory system calls for each type of executables.\nFor the dynamically-linked executable, the dynamically-linked library (",(0,i.yg)("inlineCode",{parentName:"p"},"/lib/x86_64-linux-gnu/libc.so.6"),") is opened during runtime:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},'student@os:~/.../static-dynamic/support$ strace ./hello\nexecve("./hello", ["./hello"], 0x7ffc409c6640 /- 66 vars */) = 0\nbrk(NULL)                               = 0x55a72eda6000\naccess("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)\naccess("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3\nfstat(3, {st_mode=S_IFREG|0644, st_size=198014, ...}) = 0\nmmap(NULL, 198014, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f3136a41000\nclose(3)                                = 0\naccess("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, "/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3\nread(3, "\\177ELF\\2\\1\\1\\3\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0>\\0\\1\\0\\0\\0\\240\\35\\2\\0\\0\\0\\0\\0"..., 832) = 832\nfstat(3, {st_mode=S_IFREG|0755, st_size=2030928, ...}) = 0\nmmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f3136a3f000\nmmap(NULL, 4131552, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f3136458000\nmprotect(0x7f313663f000, 2097152, PROT_NONE) = 0\nmmap(0x7f313683f000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1e7000) = 0x7f313683f000\nmmap(0x7f3136845000, 15072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f3136845000\nclose(3)                                = 0\narch_prctl(ARCH_SET_FS, 0x7f3136a404c0) = 0\nmprotect(0x7f313683f000, 16384, PROT_READ) = 0\nmprotect(0x55a72d1bb000, 4096, PROT_READ) = 0\nmprotect(0x7f3136a72000, 4096, PROT_READ) = 0\nmunmap(0x7f3136a41000, 198014)          = 0\nfstat(1, {st_mode=S_IFCHR|0620, st_rdev=makedev(136, 18), ...}) = 0\nbrk(NULL)                               = 0x55a72eda6000\nbrk(0x55a72edc7000)                     = 0x55a72edc7000\nwrite(1, "Hello, World!\\n", 14Hello, World!\n)         = 14\nexit_group(0)                           = ?\n+++ exited with 0 +++\n\nstudent@os:~/.../static-dynamic/support$ strace ./hello_static\nexecve("./hello_static", ["./hello_static"], 0x7ffc9fd45400 /- 66 vars */) = 0\nbrk(NULL)                               = 0xff8000\nbrk(0xff91c0)                           = 0xff91c0\narch_prctl(ARCH_SET_FS, 0xff8880)       = 0\nuname({sysname="Linux", nodename="yggdrasil", ...}) = 0\nreadlink("/proc/self/exe", "/home/razvan/school/so/operating"..., 4096) = 116\nbrk(0x101a1c0)                          = 0x101a1c0\nbrk(0x101b000)                          = 0x101b000\naccess("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)\nfstat(1, {st_mode=S_IFCHR|0620, st_rdev=makedev(136, 18), ...}) = 0\nwrite(1, "Hello, World!\\n", 14Hello, World!\n)         = 14\nexit_group(0)                           = ?\n+++ exited with 0 +++\n')),(0,i.yg)("p",null,"Similarly, we can investigate a system executable (",(0,i.yg)("inlineCode",{parentName:"p"},"/bin/ls"),") to see that indeed all referenced dynamically-linked libraries are opened (via the ",(0,i.yg)("inlineCode",{parentName:"p"},"openat")," system call) at runtime:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},'student@os:~/.../static-dynamic/support$ ldd $(which ls)\n    linux-vdso.so.1 (0x00007ffc3bdf3000)\n    libselinux.so.1 => /lib/x86_64-linux-gnu/libselinux.so.1 (0x00007f092bd88000)\n    libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f092b997000)\n    libpcre.so.3 => /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007f092b726000)\n    libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f092b522000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007f092c1d2000)\n    libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f092b303000)\n\nstudent@os:~/.../static-dynamic/support$ strace -e openat ls\nopenat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3\nopenat(AT_FDCWD, "/lib/x86_64-linux-gnu/libselinux.so.1", O_RDONLY|O_CLOEXEC) = 3\nopenat(AT_FDCWD, "/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3\nopenat(AT_FDCWD, "/lib/x86_64-linux-gnu/libpcre.so.3", O_RDONLY|O_CLOEXEC) = 3\nopenat(AT_FDCWD, "/lib/x86_64-linux-gnu/libdl.so.2", O_RDONLY|O_CLOEXEC) = 3\nopenat(AT_FDCWD, "/lib/x86_64-linux-gnu/libpthread.so.0", O_RDONLY|O_CLOEXEC) = 3\nopenat(AT_FDCWD, "/proc/filesystems", O_RDONLY|O_CLOEXEC) = 3\nopenat(AT_FDCWD, "/usr/lib/locale/locale-archive", O_RDONLY|O_CLOEXEC) = 3\nopenat(AT_FDCWD, ".", O_RDONLY|O_NONBLOCK|O_CLOEXEC|O_DIRECTORY) = 3\ncommunity  docs  _index.html  search.md\n+++ exited with 0 +++\n')),(0,i.yg)("p",null,(0,i.yg)("a",{parentName:"p",href:"Questions/dynamic-libraries"},"Quiz 1")),(0,i.yg)("p",null,(0,i.yg)("a",{parentName:"p",href:"Questions/static-executables"},"Quiz 2")),(0,i.yg)("h2",{id:"common-functions"},"Common Functions"),(0,i.yg)("p",null,"By using wrapper calls, we are able to write our programs in C.\nHowever, we still need to implement common functions for string management, working with I/O, working with memory."),(0,i.yg)("p",null,"The simple attempt is to implement these functions (",(0,i.yg)("inlineCode",{parentName:"p"},"printf()")," or ",(0,i.yg)("inlineCode",{parentName:"p"},"strcpy()")," or ",(0,i.yg)("inlineCode",{parentName:"p"},"malloc()"),") once in a C source code file and then reuse them when needed.\nThis saves us time (we don't have to reimplement) and allows us to constantly improve one implementation constantly;\nthere will only be one implementation that we update to increase its safety, efficiency or performance."),(0,i.yg)("p",null,"Go to ",(0,i.yg)("inlineCode",{parentName:"p"},"chapters/software-stack/libc/drills/tasks/common-functions/")," and run ",(0,i.yg)("inlineCode",{parentName:"p"},"make skels"),".\nThe ",(0,i.yg)("inlineCode",{parentName:"p"},"support/")," folder stores the implementation of string management functions, in ",(0,i.yg)("inlineCode",{parentName:"p"},"os_string.c")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"os_string.h")," and of printing functions in ",(0,i.yg)("inlineCode",{parentName:"p"},"printf.c")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"printf.h"),".\nThe ",(0,i.yg)("inlineCode",{parentName:"p"},"printf()")," implementation is ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/mpaland/printf"},"this one"),"."),(0,i.yg)("p",null,"There are two programs: ",(0,i.yg)("inlineCode",{parentName:"p"},"main_string.c")," showcases string management functions, ",(0,i.yg)("inlineCode",{parentName:"p"},"main_printf.c")," showcases the ",(0,i.yg)("inlineCode",{parentName:"p"},"printf()")," function."),(0,i.yg)("p",null,(0,i.yg)("inlineCode",{parentName:"p"},"main_string.c")," depends on the ",(0,i.yg)("inlineCode",{parentName:"p"},"os_string.h")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"os_string.c")," files that implement the ",(0,i.yg)("inlineCode",{parentName:"p"},"os_strlen()")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"os_strcpy()")," functions.\nWe print messages using the ",(0,i.yg)("inlineCode",{parentName:"p"},"write()")," system call wrapper implemented in ",(0,i.yg)("inlineCode",{parentName:"p"},"syscall.s")),(0,i.yg)("p",null,"Let's build and run the program:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},'student@os:~/.../common-functions/support/src$ make main_string\ngcc -fno-PIC -fno-stack-protector   -c -o main_string.o main_string.c\ngcc -fno-PIC -fno-stack-protector   -c -o os_string.o os_string.c\nnasm -f elf64 -o syscall.o syscall.s\ngcc -nostdlib -no-pie -Wl,--entry=main -Wl,--build-id=none main_string.o os_string.o syscall.o -o main_string\n\nstudent@os:~/.../common-functions/support/src$ ./main_string\nDestination string is: warhammer40k\n\nstudent@os:~/.../common-functions/support/src$ strace ./main_string\nexecve("./main_string", ["./main_string"], 0x7ffd544d0a70 /- 63 vars */) = 0\nwrite(1, "Destination string is: ", 23Destination string is: ) = 23\nwrite(1, "warhammer40k\\n", 13warhammer40k\n)          = 13\nexit(0)                                 = ?\n+++ exited with 0 +++\n')),(0,i.yg)("p",null,"When using ",(0,i.yg)("inlineCode",{parentName:"p"},"strace")," we see that only the ",(0,i.yg)("inlineCode",{parentName:"p"},"write()")," system call wrapper triggers a system call.\nThere are no system calls triggered by ",(0,i.yg)("inlineCode",{parentName:"p"},"os_strlen()")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"os_strcpy()")," as can be seen in their implementation."),(0,i.yg)("p",null,"In addition, ",(0,i.yg)("inlineCode",{parentName:"p"},"main_printf.c")," depends on the ",(0,i.yg)("inlineCode",{parentName:"p"},"printf.h")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"printf.c")," files that implement the ",(0,i.yg)("inlineCode",{parentName:"p"},"printf()")," function.\nThere is a requirement to implement the ",(0,i.yg)("inlineCode",{parentName:"p"},"_putchar()")," function;\nwe implement it in the ",(0,i.yg)("inlineCode",{parentName:"p"},"main_printf.c")," file using the ",(0,i.yg)("inlineCode",{parentName:"p"},"write()")," syscall call wrapper.\nThe ",(0,i.yg)("inlineCode",{parentName:"p"},"main()")," function ",(0,i.yg)("inlineCode",{parentName:"p"},"main_printf.c")," file contains all the string and printing calls.\n",(0,i.yg)("inlineCode",{parentName:"p"},"printf()")," offers a more powerful printing interface, allowing us to print addresses and integers."),(0,i.yg)("p",null,"Let's build and run the program:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},'student@os:~/.../common-functions/support$ make main_printf\ngcc -fno-PIC -fno-stack-protector   -c -o main_printf.o main_printf.c\ngcc -fno-PIC -fno-stack-protector   -c -o printf.o printf.c\ngcc -no-pie  main_printf.o printf.o syscall.o   -o main_printf\n\nstudent@os:~/.../common-functions/support$ ./main_printf\n[before] src is at 00000000004026A0, len is 12, content: "warhammer40k"\n[before] dest is at 0000000000603000, len is 0, content: ""\ncopying src to dest\n[after] src is at 00000000004026A0, len is 12, content: "warhammer40k"\n[after] dest is at 0000000000603000, len is 12, content: "warhammer40k"\n\nstudent@os:~/.../common-functions/support$ strace ./main_printf\n[...]\nwrite(1, "[", 1[)                        = 1\nwrite(1, "b", 1b)                        = 1\nwrite(1, "e", 1e)                        = 1\nwrite(1, "f", 1f)                        = 1\nwrite(1, "o", 1o)                        = 1\nwrite(1, "r", 1r)                        = 1\nwrite(1, "e", 1e)                        = 1\nwrite(1, "]", 1])                        = 1\n[...]\n')),(0,i.yg)("p",null,"We see that we have greater printing flexibility with the ",(0,i.yg)("inlineCode",{parentName:"p"},"printf()")," function.\nHowever, one downside of the current implementation is that it makes a system call for each character.\nThis is inefficient and could be improved by printing a whole string."),(0,i.yg)("h2",{id:"libraries-and-libc"},"Libraries and libc"),(0,i.yg)("p",null,"Once we have common functions implemented, we can reuse them at any time.\nThe main unit for software reusability is the ",(0,i.yg)("strong",{parentName:"p"},"library"),".\nIn short, a library is a common machine code that can be linked against different other software components.\nEach time we want to use the ",(0,i.yg)("inlineCode",{parentName:"p"},"printf()")," function or the ",(0,i.yg)("inlineCode",{parentName:"p"},"strlen()")," function, we don't need to reimplement them.\nWe also don't need to use existing source code files, rebuild them and reuse them.\nWe (re)use existing machine code in libraries."),(0,i.yg)("p",null,"A library is a collection of object files that export given data structures and functions to be used by other programs.\nWe create a program, we compile and then we link it against the library for all the features it provides."),(0,i.yg)("p",null,"The most important library in modern operating systems is the ",(0,i.yg)("strong",{parentName:"p"},"standard C library"),", also called ",(0,i.yg)("strong",{parentName:"p"},"libc"),".\nThis is the library providing system call wrappers and basic functionality for input-output, string management, memory management.\nBy default, a program is always linked with the standard C library.\nIn the examples above, we've explicitly disabled the use of the standard C library with the help of the ",(0,i.yg)("inlineCode",{parentName:"p"},"-nostdlib")," linker option."),(0,i.yg)("p",null,"By using the standard C library, it's much easier to create new programs.\nYou call existing functionality in the library and implement only features particular to your program."),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"chapters/software-stack/libc/drills/tasks/libc/support/")," folder stores the implementation of programs using the standard C library: ",(0,i.yg)("inlineCode",{parentName:"p"},"hello.c"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"main_string.c")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"main_printf.c"),".\nThese programs are almost identical to those used in the past sections:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"hello.c")," is similar to the programs in ",(0,i.yg)("inlineCode",{parentName:"li"},"chapters/software-stack/system-calls/drills/tasks/basic-syscall/solution/")," and ",(0,i.yg)("inlineCode",{parentName:"li"},"chapters/software-stack/system-calls/drills/tasks/syscall-wrapper/solution/")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"main_string.c")," and ",(0,i.yg)("inlineCode",{parentName:"li"},"main_printf.c")," are similar to the programs in ",(0,i.yg)("inlineCode",{parentName:"li"},"chapters/software-stack/libc/drills/tasks/common-functions/solution/"))),(0,i.yg)("p",null,"Let's build and run them:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},'student@os:~/.../libc/support$ ls\nhello  hello.c  hello.o  main_printf  main_printf.c  main_printf.o  main_string  main_string.c  main_string.o  Makefile\n\nstudent@os:~/.../libc/support$ make clean\nrm -f hello hello.o\nrm -f main_printf main_printf.o\nrm -f main_string main_string.o\n\nstudent@os:~/.../libc/support$ ls\nhello.c  main_printf.c  main_string.c  Makefile\n\nstudent@os:~/.../libc/support$ make\ncc -Wall   -c -o hello.o hello.c\ncc -static  hello.o   -o hello\ncc -Wall   -c -o main_printf.o main_printf.c\ncc -static  main_printf.o   -o main_printf\ncc -Wall   -c -o main_string.o main_string.c\ncc -static  main_string.o   -o main_string\n\nstudent@os:~/.../libc/support$ ls\nhello  hello.c  hello.o  main_printf  main_printf.c  main_printf.o  main_string  main_string.c  main_string.o  Makefile\n\nstudent@os:~/.../libc/support$ ./hello\nHello, world!\nBye, world!\naaa\naaa\n^C\n\nstudent@os:~/.../libc/support$ ./main_string\nDestination string is: warhammer40k\n\nstudent@os:~/.../libc/support$ ./main_printf\n[before] src is at 0x492308, len is 12, content: "warhammer40k"\n[before] dest is at 0x6bb340, len is 0, content: ""\ncopying src to dest\n[after] src is at 0x492308, len is 12, content: "warhammer40k"\n[after] dest is at 0x6bb340, len is 12, content: "warhammer40k"\nabc\n')),(0,i.yg)("p",null,"The behavior / output is similar to the ones in the previous sections:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},'student@os:~/.../libc/support$ ../../solution/basic-syscall/hello-nasm\nHello, world!\nBye, world!\naaa\naaa\n^C\n\nstudent@os:~/.../libc/support$ ../../solution/common-functions/main_string\nDestination string is: warhammer40k\n\nstudent@os:~/.../libc/support$ ../../solution/common-functions/main_printf\n[before] src is at 0000000000402680, len is 12, content: "warhammer40k"\n[before] dest is at 0000000000604000, len is 0, content: ""\ncopying src to dest\n[after] src is at 0000000000402680, len is 12, content: "warhammer40k"\n[after] dest is at 0000000000604000, len is 12, content: "warhammer40k"\nabc\n')),(0,i.yg)("p",null,"We can inspect the system calls made to check the similarities.\nFor example, for the ",(0,i.yg)("inlineCode",{parentName:"p"},"main_printf")," program we get the outputs:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},'student@os:~/.../libc/support$ strace ./main_printf\nexecve("./main_printf", ["./main_printf"], 0x7fff7b38c240 /- 66 vars */) = 0\nbrk(NULL)                               = 0x15af000\nbrk(0x15b01c0)                          = 0x15b01c0\narch_prctl(ARCH_SET_FS, 0x15af880)      = 0\nuname({sysname="Linux", nodename="[...]", ...}) = 0\nreadlink("/proc/self/exe", "[...]/operating"..., 4096) = 105\nbrk(0x15d11c0)                          = 0x15d11c0\nbrk(0x15d2000)                          = 0x15d2000\naccess("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)\nfstat(1, {st_mode=S_IFCHR|0620, st_rdev=makedev(136, 18), ...}) = 0\nwrite(1, "[before] src is at 0x492308, len"..., 64[before] src is at 0x492308, len is 12, content: "warhammer40k"\n) = 64\nwrite(1, "[before] dest is at 0x6bb340, le"..., 52[before] dest is at 0x6bb340, len is 0, content: ""\n) = 52\nwrite(1, "copying src to dest\\n", 20copying src to dest\n)   = 20\nwrite(1, "[after] src is at 0x492308, len "..., 63[after] src is at 0x492308, len is 12, content: "warhammer40k"\n) = 63\nwrite(1, "[after] dest is at 0x6bb340, len"..., 64[after] dest is at 0x6bb340, len is 12, content: "warhammer40k"\n) = 64\nwrite(1, "ab", 2ab)                       = 2\nwrite(1, "c\\n", 2c\n)                      = 2\nexit_group(0)                           = ?\n+++ exited with 0 +++\n\nstudent@os:~/.../libc/support$ strace ../../solution/common-functions/main_printf\nexecve("../../solution/common-functions/main_printf", ["../../solution/common-functions/"...], 0x7ffe204eec00 /- 66 vars */) = 0\nwrite(1, "[before] src is at 0000000000402"..., 72[before] src is at 0000000000402680, len is 12, content: "warhammer40k"\n) = 72\nwrite(1, "[before] dest is at 000000000060"..., 60[before] dest is at 0000000000604000, len is 0, content: ""\n) = 60\nwrite(1, "copying src to dest\\n", 20copying src to dest\n)   = 20\nwrite(1, "[after] src is at 00000000004026"..., 71[after] src is at 0000000000402680, len is 12, content: "warhammer40k"\n) = 71\nwrite(1, "[after] dest is at 0000000000604"..., 72[after] dest is at 0000000000604000, len is 12, content: "warhammer40k"\n) = 72\nwrite(1, "ab", 2ab)                       = 2\nwrite(1, "c\\n", 2c\n)                      = 2\nexit(0)                                 = ?\n+++ exited with 0 +++\n')),(0,i.yg)("p",null,"The output is similar, with differences at the beginning and the end of the system call trace.\nIn the case of the libc-built program, a series of additional system calls (",(0,i.yg)("inlineCode",{parentName:"p"},"brk"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"arch_prctl"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"uname")," etc.) are made.\nAlso, there is an implicit call to ",(0,i.yg)("inlineCode",{parentName:"p"},"exit_group")," instead of an explicit one to ",(0,i.yg)("inlineCode",{parentName:"p"},"exit")," in the non-libc case.\nThese are initialization and cleanup routines that are implicitly added when using the standard C library.\nThey are generally used for setting and cleaning up the stack, environment variables and other pieces of information required by the program or the standard C library itself."),(0,i.yg)("p",null,"We could argue that the initialization steps incur overhead, and that's a downside of using the standard C library.\nHowever, these initialization steps are required for almost all programs.\nAnd, given that almost all programs make use of the basic features of the standard C library, libc is almost always used.\nWe can say the above were exceptions to the rule, where we didn't make use of the standard C library."),(0,i.yg)("p",null,"Summarizing, the advantages and disadvantages of using the standard C library are:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"(+) easier development: do calls to existing functions already implemented in the standard C library;\ndefault build and link flags"),(0,i.yg)("li",{parentName:"ul"},"(+) portability: if the system provides a standard C library, one calls the library functions that will then interact with the lower-layer API"),(0,i.yg)("li",{parentName:"ul"},"(+) implicit initialization and cleanup: no need for you do explicitly create them"),(0,i.yg)("li",{parentName:"ul"},"(-) usually larger in size (static) executables"),(0,i.yg)("li",{parentName:"ul"},"(-) a level of overhead as the standard C library wraps system calls"),(0,i.yg)("li",{parentName:"ul"},"(-) potential security issues: a larger set of (potentially vulnerable) functions are presented by the standard C library")),(0,i.yg)("h2",{id:"high-level-languages"},"High-Level Languages"),(0,i.yg)("p",null,"Using the standard C library (libc) frees the programmer from the cumbersome steps of invoking system calls and reimplementing common features.\nStill, for improved development time and safety, other programming languages can be used, such as Rust, Python, JavaScript.\nMost (if not all) of these high-level programming languages still make use of the standard C library.\nSuch that a call to a function in Python would end-up making a call to a function in the standard C library."),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"chapters/software-stack/high-level-languages/drills/tasks/high-level-lang/support/"),' folder stores the implementation of a simple "Hello, World!"-printing program in Python.\nWe simply invoke the ',(0,i.yg)("inlineCode",{parentName:"p"},"python")," interpreter to run the program:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},"student@os:~/.../high-level-lang/support$ python hello.py\nHello, world!\n")),(0,i.yg)("p",null,"We count the number of functions called from the standard C library and the number of system calls:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},"student@os:~/.../high-level-lang/support$ ltrace -l 'libc*' python hello.py 2> libc.out\nHello, world!\n\nstudent@os:~/.../high-level-lang/support$ wc -l libc.out\n50469 out\n\nstudent@os:~/.../high-level-lang/support$ strace python hello.py 2> syscall.out\nHello, world!\n\nstudent@os:~/.../high-level-lang/support$ wc -l syscall.out\n948 syscall.out\n")),(0,i.yg)("p",null,"The dynamic standard C library (",(0,i.yg)("inlineCode",{parentName:"p"},"libc.so.6"),") is a dependency of the Python interpreter (",(0,i.yg)("inlineCode",{parentName:"p"},"/usr/bin/python3"),"):"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},"student@os:~/.../high-level-lang/support$ ldd /usr/bin/python3\n[...]\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007fa6fd6d0000)\n[...]\n")),(0,i.yg)("p",null,"We can see the complexity of invoking the Python interpreter, resulting in more the 50,000 of library calls being made.\nThis means added overhead versus a simple C function.\nHowever, this also means faster development in the Python programming language.\nEach new layer in the software stack simplifies development but adds overhead."),(0,i.yg)("p",null,"We can use ",(0,i.yg)("inlineCode",{parentName:"p"},"perf"),' to compare the running time between the Python and a C "Hello, World!"-printing programs:'),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},"student@os:~/.../high-level-lang/support$ sudo perf stat ../static-dynamic/hello\nHello, World!\n\n Performance counter stats for '../static-dynamic/hello':\n\n              0.46 msec task-clock                #    0.559 CPUs utilized\n                 0      context-switches          #    0.000 K/sec\n                 0      cpu-migrations            #    0.000 K/sec\n                52      page-faults               #    0.114 M/sec\n           859,341      cycles                    #    1.882 GHz\n           713,395      instructions              #    0.83  insn per cycle\n           141,710      branches                  #  310.393 M/sec\n             6,208      branch-misses             #    4.38% of all branches\n\n       0.000816974 seconds time elapsed\n\n       0.000872000 seconds user\n       0.000000000 seconds sys\n\nstudent@os:~/.../high-level-lang/support$ sudo perf stat python hello.py\nHello, world!\n\n Performance counter stats for 'python hello.py':\n\n             69.39 msec task-clock                #    0.992 CPUs utilized\n                 2      context-switches          #    0.029 K/sec\n                 0      cpu-migrations            #    0.000 K/sec\n             1,115      page-faults               #    0.016 M/sec\n        74,405,125      cycles                    #    1.072 GHz\n        84,957,056      instructions              #    1.14  insn per cycle\n        18,574,724      branches                  #  267.689 M/sec\n           759,104      branch-misses             #    4.09% of all branches\n\n       0.069981351 seconds time elapsed\n\n       0.054376000 seconds user\n       0.015536000 seconds sys\n")),(0,i.yg)("p",null,"We can see that on all metrics, the running of the Python program is less efficient than the running of the C program.\nThe Python code takes ",(0,i.yg)("inlineCode",{parentName:"p"},"69")," milliseconds, whereas the C code runs in less than ",(0,i.yg)("inlineCode",{parentName:"p"},"1")," millisecond."),(0,i.yg)("p",null,"When deciding what programming language and what libraries and software components to use, you have to balance requirements for fast development and increased safety (inherent to higher-level programming languages) with requirements for speed or efficiency (common to lower-level programming languages such as C).\nNewer modern programming languages such as Go, Rust, D aim to add the benefits of high-level programming languages and keep efficiency close to the C programming language.\nGenerally, additional software layers (libraries, language environments, interpreters) simplify development but decrease speed and efficiency."),(0,i.yg)("h2",{id:"app-investigation"},"App Investigation"),(0,i.yg)("p",null,"Let's spend some time investigating actual applications residing on the local system.\nFor now, we know that applications are developed using high-level languages and then compiled or interpreted to use the lower-layer interfaces of the software stack, such as the system call API."),(0,i.yg)("p",null,"Let's enter the ",(0,i.yg)("inlineCode",{parentName:"p"},"chapters/software-stack/applications/drills/tasks/app-investigation/support/")," folder and run the ",(0,i.yg)("inlineCode",{parentName:"p"},"get_app_types.sh")," script:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},"student@os:~/.../app-investigation/support/$ ./get_app_types.sh\nbinary apps: 2223\nPerl apps: 256\nShell apps: 454\nPython apps: 123\nOther apps: 27\n")),(0,i.yg)("p",null,"The script prints the types of the application executables in the system.\nThe output will differ between systems, given each has particular types of applications installed."),(0,i.yg)("p",null,"We list them by running the command inside the ",(0,i.yg)("inlineCode",{parentName:"p"},"get_app_types.sh")," script:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-console"},"student@os:~/.../app-investigation/support/$ find /usr/bin /bin /usr/sbin /sbin -type f -exec file {} \\;\n[...]\n/usr/bin/qpdldecode: ELF 64-bit LSB shared object, x86-64 [...]\n/usr/bin/mimeopen: Perl script text executable\n[...]\n")),(0,i.yg)("p",null,"As above, the output will differ between systems."),(0,i.yg)("p",null,"So, depending on the developers' choice, applications may be:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"compiled into executables, from compiled languages such as C, C++, Go, Rust, D"),(0,i.yg)("li",{parentName:"ul"},"developed as scripts, from interpreted languages such as Python, Perl, JavaScript")))}d.isMDXComponent=!0}}]);