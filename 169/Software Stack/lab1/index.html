<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Software Stack/lab1">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Lab 1 - Operating System Perspective | Operating Systems</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://localhost//operating-systems/169/Software Stack/lab1"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lab 1 - Operating System Perspective | Operating Systems"><meta data-rh="true" name="description" content="The contents of the lab are located in the GitHub repository and in the lab archive."><meta data-rh="true" property="og:description" content="The contents of the lab are located in the GitHub repository and in the lab archive."><link data-rh="true" rel="canonical" href="http://localhost//operating-systems/169/Software Stack/lab1"><link data-rh="true" rel="alternate" href="http://localhost//operating-systems/169/Software Stack/lab1" hreflang="en"><link data-rh="true" rel="alternate" href="http://localhost//operating-systems/169/Software Stack/lab1" hreflang="x-default"><link rel="stylesheet" href="/operating-systems/169/assets/css/styles.48876178.css">
<link rel="preload" href="/operating-systems/169/assets/js/runtime~main.78364b44.js" as="script">
<link rel="preload" href="/operating-systems/169/assets/js/main.a92f4421.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/operating-systems/169/"><div class="navbar__logo"><img src="/operating-systems/169/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/operating-systems/169/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">SO</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/operating-systems/169/Software Stack">Software Stack</a><a class="navbar__item navbar__link" href="/operating-systems/169/Data">Data</a><a class="navbar__item navbar__link" href="/operating-systems/169/Compute">Compute</a><a class="navbar__item navbar__link" href="/operating-systems/169/IO">IO</a><a class="navbar__item navbar__link" href="/operating-systems/169/Application Interaction">Application Interaction</a><a class="navbar__item navbar__link" href="/operating-systems/169/Assignments">Assignments</a><a class="navbar__item navbar__link" href="/operating-systems/169/Exams">Exams</a><a class="navbar__item navbar__link" href="/operating-systems/169/Hackathons">Hackathons</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operating-systems/169/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operating-systems/169/lab-setup">Setting up the Lab Environment</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/operating-systems/169/Software Stack/">Software Stack</a><button aria-label="Toggle the collapsible sidebar category &#x27;Software Stack&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/169/Software Stack/Software-Stack">Slides</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/169/Software Stack/software-stack-overview">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/operating-systems/169/Software Stack/Questions/">Questions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Questions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/operating-systems/169/Software Stack/lab1">Lab 1 - Operating System Perspective</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/operating-systems/169/Software Stack/lab2">Lab 2 - Library Perspective</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/operating-systems/169/Data/">Data</a><button aria-label="Toggle the collapsible sidebar category &#x27;Data&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/operating-systems/169/Compute/">Compute</a><button aria-label="Toggle the collapsible sidebar category &#x27;Compute&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/operating-systems/169/IO/">IO</a><button aria-label="Toggle the collapsible sidebar category &#x27;IO&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/operating-systems/169/Application Interaction/">Application Interaction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Application Interaction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/operating-systems/169/Assignments/">Assignments</a><button aria-label="Toggle the collapsible sidebar category &#x27;Assignments&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/operating-systems/169/Exams/">Exams</a><button aria-label="Toggle the collapsible sidebar category &#x27;Exams&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/operating-systems/169/Hackathons/">Hackathons</a><button aria-label="Toggle the collapsible sidebar category &#x27;Hackathons&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operating-systems/169/rules-and-grading">Rules and Grading</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/operating-systems/169/resources">Resources</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/operating-systems/169/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/operating-systems/169/Software Stack/"><span itemprop="name">Software Stack</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab 1 - Operating System Perspective</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Lab 1 - Operating System Perspective</h1><p>The contents of the lab are located in the <a href="https://github.com/cs-pub-ro/operating-systems" target="_blank" rel="noopener noreferrer">GitHub repository</a> and in the <a href="https://github.com/cs-pub-ro/operating-systems/raw/refs/heads/lab-archives/Lab_1_Operating_System_Perspective.zip" target="_blank" rel="noopener noreferrer">lab archive</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-system-calls">Task: System Calls<a class="hash-link" href="#task-system-calls" title="Direct link to heading">​</a></h2><p>Enter the <code>chapters/software-stack/system-calls/drills/tasks/basic-syscall/</code> folder.
Run <code>make</code> and then enter <code>chapters/software-stack/system-calls/drills/tasks/basic-syscall/support/</code> folder and go through the practice items below.</p><p>For debugging, use <code>strace</code> to trace the system calls from your program and make sure the arguments are set right.</p><ol><li>Update the <code>hello.asm</code> and / or <code>hello.s</code> files to print both <code>Hello, world!</code> and <code>Bye, world!</code>.
This means adding another <code>write()</code> system call.</li></ol><iframe id="e2588adf-b572-4171-993d-44231dafb5ae" srcdoc="&lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; integrity=&quot;sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js&quot; integrity=&quot;sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css&quot;&gt;&lt;script src=&quot;//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js&quot;&gt;&lt;/script&gt;&lt;script&gt;hljs.highlightAll();&lt;/script&gt;&lt;div class=&quot;card d-flex&quot; style=&quot;width: 75%; margin: auto; margin-top: 1rem; margin-bottom: 1rem;&quot;&gt; &lt;div class=&quot;card-header&quot; id=&quot;20cc6efb-1cc7-45a6-b228-bd2dfae84afe&quot;&gt; &lt;p&gt;What register stores the system call ID on x86_64?&lt;/p&gt; &lt;/div&gt; &lt;ul class=&quot;list-group list-group-flush&quot;&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;82092985-e9e0-4630-815b-4938c7d78d77&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;82092985-e9e0-4630-815b-4938c7d78d77&quot;&gt; &lt;p&gt;&lt;code&gt;RAX&lt;/code&gt;&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;1b45b020-0a97-4a91-b0e2-9d99effa2616&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;1b45b020-0a97-4a91-b0e2-9d99effa2616&quot;&gt; &lt;p&gt;&lt;code&gt;RIP&lt;/code&gt;&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;a4bbcd6d-a242-4072-8257-b64264640edf&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;a4bbcd6d-a242-4072-8257-b64264640edf&quot;&gt; &lt;p&gt;&lt;code&gt;RDX&lt;/code&gt;&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;2aa0fe2f-9917-4fcb-a628-3d4bd04344f1&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;2aa0fe2f-9917-4fcb-a628-3d4bd04344f1&quot;&gt; &lt;p&gt;&lt;code&gt;RSP&lt;/code&gt;&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;/ul&gt; &lt;div class=&quot;card-footer&quot;&gt; &lt;div class=&quot;text-center&quot; style=&quot;padding: 5px;&quot;&gt; &lt;button class=&quot;check btn btn-primary&quot; type=&quot;button&quot; onclick=&quot;console.log(&#x27;Clickedcheck&#x27;);answerIndex=&#x27;82092985-e9e0-4630-815b-4938c7d78d77&#x27;;document.getElementsByClassName(&#x27;check&#x27;)[0].classList.add(&#x27;disabled&#x27;);choices=document.getElementsByClassName(&#x27;choice&#x27;);for(i=0;i&lt;choices.length;i++){radio=choices[i].firstElementChild.firstElementChild;radio.disabled=true;if(radio.checked){if(radio.id===answerIndex){choices[i].classList.add(&#x27;list-group-item-success&#x27;);document.getElementsByClassName(&#x27;feedback&#x27;)[0].classList.remove(&#x27;d-none&#x27;);var savTop=parent.document.documentElement.scrollTop;document.getElementsByClassName(&#x27;feedback&#x27;)[0].scrollIntoView(false);parent.document.documentElement.scrollTop=savTop;}else{choices[i].classList.add(&#x27;list-group-item-danger&#x27;);}}}&quot;&gt;Check Answer &lt;/button&gt; &lt;button class=&quot;reset btn btn-default&quot; type=&quot;button&quot; onclick=&quot;console.log(&#x27;Clickedreset&#x27;);document.getElementsByClassName(&#x27;check&#x27;)[0].classList.remove(&#x27;disabled&#x27;);choices=document.getElementsByClassName(&#x27;choice&#x27;);for(i=0;i&lt;choices.length;i++){radio=choices[i].firstElementChild.firstElementChild;radio.disabled=false;choices[i].classList.remove(&#x27;list-group-item-success&#x27;);choices[i].classList.remove(&#x27;list-group-item-danger&#x27;);radio.checked=false;}document.getElementsByClassName(&#x27;feedback&#x27;)[0].classList.add(&#x27;d-none&#x27;);var savTop=parent.document.documentElement.scrollTop;document.getElementsByClassName(&#x27;card&#x27;)[0].scrollIntoView(false);parent.document.documentElement.scrollTop=savTop;&quot;&gt;Try Again&lt;/button&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;feedback card d-flex d-none&quot; style=&quot;width: 80%; margin: auto; margin-top: 1rem;&quot;&gt; &lt;div class=&quot;card-header&quot;&gt; Feedback &lt;/div&gt; &lt;div class=&quot;card-body alert alert-success&quot;&gt; &lt;p&gt;&lt;code&gt;RAX&lt;/code&gt; is the register used for passing the syscall ID and the result code.&lt;/p&gt; &lt;/div&gt;&lt;/div&gt;" width="100%" style="border:none;overflow:hidden"></iframe><iframe id="0dc163cd-d8ba-4fce-8115-32e9d91bb7ea" srcdoc="&lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; integrity=&quot;sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js&quot; integrity=&quot;sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css&quot;&gt;&lt;script src=&quot;//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js&quot;&gt;&lt;/script&gt;&lt;script&gt;hljs.highlightAll();&lt;/script&gt;&lt;div class=&quot;card d-flex&quot; style=&quot;width: 75%; margin: auto; margin-top: 1rem; margin-bottom: 1rem;&quot;&gt; &lt;div class=&quot;card-header&quot; id=&quot;65ca175c-c4b8-4a91-9464-a11fa1f0cdfe&quot;&gt; &lt;p&gt;What tool do we use to capture system calls?&lt;/p&gt; &lt;/div&gt; &lt;ul class=&quot;list-group list-group-flush&quot;&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;9a85d8b2-7e97-403d-b2cb-5760583c7c84&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;9a85d8b2-7e97-403d-b2cb-5760583c7c84&quot;&gt; &lt;p&gt;&lt;code&gt;./exec&lt;/code&gt;&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;1342f6bc-916e-4b18-9c66-732ddfff8459&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;1342f6bc-916e-4b18-9c66-732ddfff8459&quot;&gt; &lt;p&gt;&lt;code&gt;strace&lt;/code&gt;&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;9da0e838-244c-4f3c-b1e0-543600a1e414&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;9da0e838-244c-4f3c-b1e0-543600a1e414&quot;&gt; &lt;p&gt;&lt;code&gt;gcc&lt;/code&gt;&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;16cfafe1-0bd8-4a8b-9259-707500e9ce19&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;16cfafe1-0bd8-4a8b-9259-707500e9ce19&quot;&gt; &lt;p&gt;&lt;code&gt;make&lt;/code&gt;&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;/ul&gt; &lt;div class=&quot;card-footer&quot;&gt; &lt;div class=&quot;text-center&quot; style=&quot;padding: 5px;&quot;&gt; &lt;button class=&quot;check btn btn-primary&quot; type=&quot;button&quot; onclick=&quot;console.log(&#x27;Clickedcheck&#x27;);answerIndex=&#x27;1342f6bc-916e-4b18-9c66-732ddfff8459&#x27;;document.getElementsByClassName(&#x27;check&#x27;)[0].classList.add(&#x27;disabled&#x27;);choices=document.getElementsByClassName(&#x27;choice&#x27;);for(i=0;i&lt;choices.length;i++){radio=choices[i].firstElementChild.firstElementChild;radio.disabled=true;if(radio.checked){if(radio.id===answerIndex){choices[i].classList.add(&#x27;list-group-item-success&#x27;);document.getElementsByClassName(&#x27;feedback&#x27;)[0].classList.remove(&#x27;d-none&#x27;);var savTop=parent.document.documentElement.scrollTop;document.getElementsByClassName(&#x27;feedback&#x27;)[0].scrollIntoView(false);parent.document.documentElement.scrollTop=savTop;}else{choices[i].classList.add(&#x27;list-group-item-danger&#x27;);}}}&quot;&gt;Check Answer &lt;/button&gt; &lt;button class=&quot;reset btn btn-default&quot; type=&quot;button&quot; onclick=&quot;console.log(&#x27;Clickedreset&#x27;);document.getElementsByClassName(&#x27;check&#x27;)[0].classList.remove(&#x27;disabled&#x27;);choices=document.getElementsByClassName(&#x27;choice&#x27;);for(i=0;i&lt;choices.length;i++){radio=choices[i].firstElementChild.firstElementChild;radio.disabled=false;choices[i].classList.remove(&#x27;list-group-item-success&#x27;);choices[i].classList.remove(&#x27;list-group-item-danger&#x27;);radio.checked=false;}document.getElementsByClassName(&#x27;feedback&#x27;)[0].classList.add(&#x27;d-none&#x27;);var savTop=parent.document.documentElement.scrollTop;document.getElementsByClassName(&#x27;card&#x27;)[0].scrollIntoView(false);parent.document.documentElement.scrollTop=savTop;&quot;&gt;Try Again&lt;/button&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;feedback card d-flex d-none&quot; style=&quot;width: 80%; margin: auto; margin-top: 1rem;&quot;&gt; &lt;div class=&quot;card-header&quot;&gt; Feedback &lt;/div&gt; &lt;div class=&quot;card-body alert alert-success&quot;&gt; &lt;p&gt;&lt;code&gt;strace&lt;/code&gt; is used to trace system calls invoked by a running program.&lt;/p&gt; &lt;/div&gt;&lt;/div&gt;" width="100%" style="border:none;overflow:hidden"></iframe><iframe id="9d94fbc5-a300-4ab3-b9aa-491e7e2bb50c" srcdoc="&lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; integrity=&quot;sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js&quot; integrity=&quot;sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css&quot;&gt;&lt;script src=&quot;//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js&quot;&gt;&lt;/script&gt;&lt;script&gt;hljs.highlightAll();&lt;/script&gt;&lt;div class=&quot;card d-flex&quot; style=&quot;width: 75%; margin: auto; margin-top: 1rem; margin-bottom: 1rem;&quot;&gt; &lt;div class=&quot;card-header&quot; id=&quot;0510234f-be09-49d5-bf23-aea3d2a16526&quot;&gt; &lt;p&gt;What is the approximate number of system call numbers in Linux?&lt;/p&gt; &lt;/div&gt; &lt;ul class=&quot;list-group list-group-flush&quot;&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;38c30c37-fb7c-4712-b759-6d3198f0e1cb&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;38c30c37-fb7c-4712-b759-6d3198f0e1cb&quot;&gt; &lt;p&gt;300&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;4be75b0e-571c-4bf2-ac04-a6a7f5c7c616&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;4be75b0e-571c-4bf2-ac04-a6a7f5c7c616&quot;&gt; &lt;p&gt;3&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;37378c3f-1a8e-47e9-8674-d89e6622b731&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;37378c3f-1a8e-47e9-8674-d89e6622b731&quot;&gt; &lt;p&gt;3000&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;a85fb368-ce79-4081-935b-d028bcfa75b7&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;a85fb368-ce79-4081-935b-d028bcfa75b7&quot;&gt; &lt;p&gt;30&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;/ul&gt; &lt;div class=&quot;card-footer&quot;&gt; &lt;div class=&quot;text-center&quot; style=&quot;padding: 5px;&quot;&gt; &lt;button class=&quot;check btn btn-primary&quot; type=&quot;button&quot; onclick=&quot;console.log(&#x27;Clickedcheck&#x27;);answerIndex=&#x27;38c30c37-fb7c-4712-b759-6d3198f0e1cb&#x27;;document.getElementsByClassName(&#x27;check&#x27;)[0].classList.add(&#x27;disabled&#x27;);choices=document.getElementsByClassName(&#x27;choice&#x27;);for(i=0;i&lt;choices.length;i++){radio=choices[i].firstElementChild.firstElementChild;radio.disabled=true;if(radio.checked){if(radio.id===answerIndex){choices[i].classList.add(&#x27;list-group-item-success&#x27;);document.getElementsByClassName(&#x27;feedback&#x27;)[0].classList.remove(&#x27;d-none&#x27;);var savTop=parent.document.documentElement.scrollTop;document.getElementsByClassName(&#x27;feedback&#x27;)[0].scrollIntoView(false);parent.document.documentElement.scrollTop=savTop;}else{choices[i].classList.add(&#x27;list-group-item-danger&#x27;);}}}&quot;&gt;Check Answer &lt;/button&gt; &lt;button class=&quot;reset btn btn-default&quot; type=&quot;button&quot; onclick=&quot;console.log(&#x27;Clickedreset&#x27;);document.getElementsByClassName(&#x27;check&#x27;)[0].classList.remove(&#x27;disabled&#x27;);choices=document.getElementsByClassName(&#x27;choice&#x27;);for(i=0;i&lt;choices.length;i++){radio=choices[i].firstElementChild.firstElementChild;radio.disabled=false;choices[i].classList.remove(&#x27;list-group-item-success&#x27;);choices[i].classList.remove(&#x27;list-group-item-danger&#x27;);radio.checked=false;}document.getElementsByClassName(&#x27;feedback&#x27;)[0].classList.add(&#x27;d-none&#x27;);var savTop=parent.document.documentElement.scrollTop;document.getElementsByClassName(&#x27;card&#x27;)[0].scrollIntoView(false);parent.document.documentElement.scrollTop=savTop;&quot;&gt;Try Again&lt;/button&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;feedback card d-flex d-none&quot; style=&quot;width: 80%; margin: auto; margin-top: 1rem;&quot;&gt; &lt;div class=&quot;card-header&quot;&gt; Feedback &lt;/div&gt; &lt;div class=&quot;card-body alert alert-success&quot;&gt; &lt;p&gt;As show &lt;a href=&quot;https://x64.syscall.sh/&quot;&gt;here&lt;/a&gt;, they&#x27;re about 300 system calls in Linux.&lt;/p&gt; &lt;/div&gt;&lt;/div&gt;" width="100%" style="border:none;overflow:hidden"></iframe><ol><li><p>Update the <code>hello.asm</code> and / or <code>hello.s</code> files to sleep before the <code>exit</code> system call.</p><p>You need to make the <code>sys_nanosleep()</code> system call, with the <code>timespec</code> structure.
Find its ID <a href="https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/" target="_blank" rel="noopener noreferrer">here</a>.</p></li><li><p>Update the <code>hello.asm</code> and / or <code>hello.s</code> files to read a message from standard input and print it to standard output.</p><p>You&#x27;ll need to define a buffer in the <code>data</code> or <code>bss</code> section.
Use the <code>read</code> system call to read data in the buffer.
The return value of <code>read</code> (placed in the <code>rax</code> register) is the number of bytes read.
Use that value as the 3rd argument or <code>write</code>, i.e. the number of bytes printed.</p><p>Find the ID of the <code>read</code> system call <a href="https://x64.syscall.sh/" target="_blank" rel="noopener noreferrer">here</a>.
To find out more about its arguments, see <a href="https://man7.org/linux/man-pages/man2/read.2.html" target="_blank" rel="noopener noreferrer">its man page</a>.
Standard input descriptor is <code>0</code>.</p></li><li><p><strong>Difficult</strong>: Port the initial program to ARM on 64 bits (also called <strong>aarch64</strong>).</p><p>Use the skeleton files in the <code>arm/</code> folder.
Find information about the <code>aarch64</code> system calls <a href="https://arm64.syscall.sh/" target="_blank" rel="noopener noreferrer">here</a>.</p></li><li><p>Create your own program, written in assembly, doing some system calls you want to learn more about.
Some system calls you could try: <code>open()</code>, <code>rename()</code>, <code>mkdir()</code>.
Create a Makefile for that program.
Run the resulting program with <code>strace</code> to see the actual system calls being made (and their arguments).</p></li></ol><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/operating-systems/169/Software Stack/lab1#analyzing-the-software-stack">this</a> reading material.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-system-call-wrappers">Task: System Call Wrappers<a class="hash-link" href="#task-system-call-wrappers" title="Direct link to heading">​</a></h2><p>Enter the <code>chapters/software-stack/system-calls/syscall-wrapper/drills/tasks/support/</code> folder and go through the practice items below.</p><ol><li><p>Update the files in the <code>support/</code> folder to make <code>read</code> system call available as a wrapper.
Make a call to the <code>read</code> system call to read data from standard input in a buffer.
Then call <code>write()</code> to print data from that buffer.</p><p>Note that the <code>read</code> system call returns the number of bytes <code>read</code>.
Use that as the argument to the subsequent <code>write</code> call that prints read data.</p><p>We can see that it&#x27;s easier to have wrapper calls and write most of the code in C than in assembly language.</p></li></ol><iframe id="9a4ab336-c776-460c-9b99-e4ca08575b1e" srcdoc="&lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; integrity=&quot;sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js&quot; integrity=&quot;sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css&quot;&gt;&lt;script src=&quot;//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js&quot;&gt;&lt;/script&gt;&lt;script&gt;hljs.highlightAll();&lt;/script&gt;&lt;div class=&quot;card d-flex&quot; style=&quot;width: 75%; margin: auto; margin-top: 1rem; margin-bottom: 1rem;&quot;&gt; &lt;div class=&quot;card-header&quot; id=&quot;c3f353f1-62b4-4a7e-ae58-ef31d1a45689&quot;&gt; &lt;p&gt;What language do we use to invoke system calls?&lt;/p&gt; &lt;/div&gt; &lt;ul class=&quot;list-group list-group-flush&quot;&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;2506e27c-b8c0-4d08-9f95-be1844f4f025&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;2506e27c-b8c0-4d08-9f95-be1844f4f025&quot;&gt; &lt;p&gt;assembly&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;c6353b31-a367-4bcc-98b0-5ff02e003a88&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;c6353b31-a367-4bcc-98b0-5ff02e003a88&quot;&gt; &lt;p&gt;C++&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;c90c62e2-2f61-403e-8a6e-4acea90f9409&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;c90c62e2-2f61-403e-8a6e-4acea90f9409&quot;&gt; &lt;p&gt;Go&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;9f812aa2-b5f2-4471-8d4f-13c76f1bfacd&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;9f812aa2-b5f2-4471-8d4f-13c76f1bfacd&quot;&gt; &lt;p&gt;C&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;/ul&gt; &lt;div class=&quot;card-footer&quot;&gt; &lt;div class=&quot;text-center&quot; style=&quot;padding: 5px;&quot;&gt; &lt;button class=&quot;check btn btn-primary&quot; type=&quot;button&quot; onclick=&quot;console.log(&#x27;Clickedcheck&#x27;);answerIndex=&#x27;2506e27c-b8c0-4d08-9f95-be1844f4f025&#x27;;document.getElementsByClassName(&#x27;check&#x27;)[0].classList.add(&#x27;disabled&#x27;);choices=document.getElementsByClassName(&#x27;choice&#x27;);for(i=0;i&lt;choices.length;i++){radio=choices[i].firstElementChild.firstElementChild;radio.disabled=true;if(radio.checked){if(radio.id===answerIndex){choices[i].classList.add(&#x27;list-group-item-success&#x27;);document.getElementsByClassName(&#x27;feedback&#x27;)[0].classList.remove(&#x27;d-none&#x27;);var savTop=parent.document.documentElement.scrollTop;document.getElementsByClassName(&#x27;feedback&#x27;)[0].scrollIntoView(false);parent.document.documentElement.scrollTop=savTop;}else{choices[i].classList.add(&#x27;list-group-item-danger&#x27;);}}}&quot;&gt;Check Answer &lt;/button&gt; &lt;button class=&quot;reset btn btn-default&quot; type=&quot;button&quot; onclick=&quot;console.log(&#x27;Clickedreset&#x27;);document.getElementsByClassName(&#x27;check&#x27;)[0].classList.remove(&#x27;disabled&#x27;);choices=document.getElementsByClassName(&#x27;choice&#x27;);for(i=0;i&lt;choices.length;i++){radio=choices[i].firstElementChild.firstElementChild;radio.disabled=false;choices[i].classList.remove(&#x27;list-group-item-success&#x27;);choices[i].classList.remove(&#x27;list-group-item-danger&#x27;);radio.checked=false;}document.getElementsByClassName(&#x27;feedback&#x27;)[0].classList.add(&#x27;d-none&#x27;);var savTop=parent.document.documentElement.scrollTop;document.getElementsByClassName(&#x27;card&#x27;)[0].scrollIntoView(false);parent.document.documentElement.scrollTop=savTop;&quot;&gt;Try Again&lt;/button&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;feedback card d-flex d-none&quot; style=&quot;width: 80%; margin: auto; margin-top: 1rem;&quot;&gt; &lt;div class=&quot;card-header&quot;&gt; Feedback &lt;/div&gt; &lt;div class=&quot;card-body alert alert-success&quot;&gt; &lt;p&gt;System calls require setting of registers that can only be done in assembly language.&lt;/p&gt; &lt;/div&gt;&lt;/div&gt;" width="100%" style="border:none;overflow:hidden"></iframe><ol><li><p>Update the files in the <code>support/</code> folder to make the <code>getpid</code> system call available as a wrapper.
Create a function with the signature <code>unsigned int itoa(int n, char *a)</code> that converts an integer to a string.
It returns the number of digits in the string.
For example, it will convert the number <code>1234</code> to the string <code>&quot;1234&quot;</code> string (<code>NULL</code>-terminated, 5 bytes long);
the return value is <code>4</code> (the number of digits of the <code>&quot;1234&quot;</code> string).</p><p>Then make the call to <code>getpid</code>;
it gets no arguments and returns an integer (the PID - *process ID- of the current process).</p></li></ol><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/operating-systems/169/Software Stack/lab1#system-call-wrappers">this</a> reading material.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-library-calls-vs-system-calls">Task: Library Calls vs System Calls<a class="hash-link" href="#task-library-calls-vs-system-calls" title="Direct link to heading">​</a></h2><p>Enter the <code>chapters/software-stack/system-calls/drills/tasks/libcall-syscall/support/</code> folder and go through the practice items below.</p><ol><li><p>Check library calls and system calls for the <code>call2.c</code> file.
Use <code>ltrace</code> and <code>strace</code>.</p><p>Find explanations for the calls being made and the library call to system call mapping.</p></li></ol><iframe id="1a722a82-7734-4bb0-8817-6d7e0a9b70c4" srcdoc="&lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; integrity=&quot;sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js&quot; integrity=&quot;sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css&quot;&gt;&lt;script src=&quot;//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js&quot;&gt;&lt;/script&gt;&lt;script&gt;hljs.highlightAll();&lt;/script&gt;&lt;div class=&quot;card d-flex&quot; style=&quot;width: 75%; margin: auto; margin-top: 1rem; margin-bottom: 1rem;&quot;&gt; &lt;div class=&quot;card-header&quot; id=&quot;0546faa7-b296-4ff8-a940-065aa75fca05&quot;&gt; &lt;p&gt;Which of the following library calls will for sure invoke a system call?&lt;/p&gt; &lt;/div&gt; &lt;ul class=&quot;list-group list-group-flush&quot;&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;02568ac4-9339-420a-9d73-74dbe09b1058&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;02568ac4-9339-420a-9d73-74dbe09b1058&quot;&gt; &lt;p&gt;&lt;code&gt;fwrite()&lt;/code&gt;&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;850a7cc5-b973-4804-83dc-e4612ee27961&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;850a7cc5-b973-4804-83dc-e4612ee27961&quot;&gt; &lt;p&gt;&lt;code&gt;fopen()&lt;/code&gt;&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;c15dd4b1-6388-4091-b6f1-4566719ab07f&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;c15dd4b1-6388-4091-b6f1-4566719ab07f&quot;&gt; &lt;p&gt;&lt;code&gt;printf()&lt;/code&gt;&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;li class=&quot;list-group-item choice&quot;&gt; &lt;div class=&quot;form-check&quot;&gt; &lt;input class=&quot;form-check-input&quot; type=&quot;radio&quot; name=&quot;flexRadioDefault&quot; id=&quot;de41286f-c11a-4a5d-a287-681e8bd69f38&quot;&gt; &lt;label class=&quot;form-check-label&quot; for=&quot;de41286f-c11a-4a5d-a287-681e8bd69f38&quot;&gt; &lt;p&gt;&lt;code&gt;strcpy()&lt;/code&gt;&lt;/p&gt; &lt;/label&gt; &lt;/div&gt; &lt;/li&gt; &lt;/ul&gt; &lt;div class=&quot;card-footer&quot;&gt; &lt;div class=&quot;text-center&quot; style=&quot;padding: 5px;&quot;&gt; &lt;button class=&quot;check btn btn-primary&quot; type=&quot;button&quot; onclick=&quot;console.log(&#x27;Clickedcheck&#x27;);answerIndex=&#x27;850a7cc5-b973-4804-83dc-e4612ee27961&#x27;;document.getElementsByClassName(&#x27;check&#x27;)[0].classList.add(&#x27;disabled&#x27;);choices=document.getElementsByClassName(&#x27;choice&#x27;);for(i=0;i&lt;choices.length;i++){radio=choices[i].firstElementChild.firstElementChild;radio.disabled=true;if(radio.checked){if(radio.id===answerIndex){choices[i].classList.add(&#x27;list-group-item-success&#x27;);document.getElementsByClassName(&#x27;feedback&#x27;)[0].classList.remove(&#x27;d-none&#x27;);var savTop=parent.document.documentElement.scrollTop;document.getElementsByClassName(&#x27;feedback&#x27;)[0].scrollIntoView(false);parent.document.documentElement.scrollTop=savTop;}else{choices[i].classList.add(&#x27;list-group-item-danger&#x27;);}}}&quot;&gt;Check Answer &lt;/button&gt; &lt;button class=&quot;reset btn btn-default&quot; type=&quot;button&quot; onclick=&quot;console.log(&#x27;Clickedreset&#x27;);document.getElementsByClassName(&#x27;check&#x27;)[0].classList.remove(&#x27;disabled&#x27;);choices=document.getElementsByClassName(&#x27;choice&#x27;);for(i=0;i&lt;choices.length;i++){radio=choices[i].firstElementChild.firstElementChild;radio.disabled=false;choices[i].classList.remove(&#x27;list-group-item-success&#x27;);choices[i].classList.remove(&#x27;list-group-item-danger&#x27;);radio.checked=false;}document.getElementsByClassName(&#x27;feedback&#x27;)[0].classList.add(&#x27;d-none&#x27;);var savTop=parent.document.documentElement.scrollTop;document.getElementsByClassName(&#x27;card&#x27;)[0].scrollIntoView(false);parent.document.documentElement.scrollTop=savTop;&quot;&gt;Try Again&lt;/button&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;feedback card d-flex d-none&quot; style=&quot;width: 80%; margin: auto; margin-top: 1rem;&quot;&gt; &lt;div class=&quot;card-header&quot;&gt; Feedback &lt;/div&gt; &lt;div class=&quot;card-body alert alert-success&quot;&gt; &lt;p&gt;&lt;code&gt;fopen()&lt;/code&gt; requires opening a file and access to the operating system (for filesystem access).
The others may not require a system call (&lt;code&gt;strcpy()&lt;/code&gt;) or may use buffering to delay the invocation of a system call (&lt;code&gt;fwrite()&lt;/code&gt;, &lt;code&gt;printf()&lt;/code&gt;).&lt;/p&gt; &lt;/div&gt;&lt;/div&gt;" width="100%" style="border:none;overflow:hidden"></iframe><p>If you&#x27;re having difficulties solving this exercise, go through <a href="/operating-systems/169/Software Stack/lab1#library-calls-vs-system-calls">this</a> reading material.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="modern-software-stacks">Modern Software Stacks<a class="hash-link" href="#modern-software-stacks" title="Direct link to heading">​</a></h2><p>Most modern computing systems use a software stack such as the one in the figure below:</p><p><img loading="lazy" alt="Modern Software Stack" src="/operating-systems/169/assets/images/modern-sw-stack-4a2427d07a59c3a6599305b8eedc43dd.svg" class="img_ev3q"></p><p>This modern software stack allows fast development and provides a rich set of applications to the user.</p><p>The basic software component is the <strong>operating system*- (OS) (technically the operating system </strong>kernel<strong>).
The OS provides the fundamental primitives to interact with hardware (read and write data) and to manage the running of applications (such as memory allocation, thread creation, scheduling).
These primitives form the </strong>system call API*- or <strong>system API</strong>.
An item in the system call API, i.e. the equivalent of a function call that triggers the execution of a functionality in the operating system, is a <strong>system call</strong>.</p><p>The system call API is well-defined, stable and complete: it exposes the entire functionality of the operating system and hardware.
However, it is also minimalistic with respect to features, and it provides a low-level (close to hardware) specification, making it cumbersome to use and <strong>not portable</strong>.</p><p>Due to the downsides of the system call API, a basic library, the <strong>standard C library*- (also called </strong>libc<strong>), is built on top of it.
Because the system call API uses an OS-specific calling convention, the standard C library typically wraps each system call into an equivalent function call, following a portable calling convention.
More than these wrappers, the standard C library provides its own API that is typically portable.
Part of the API exposed by the standard C library is the </strong>standard C API<strong>, also called </strong>ANSI C*- or <strong>ISO C</strong>;
this API is typically portable across all platforms (operating systems and hardware).
This API, going beyond system call wrappers, has several advantages:</p><ul><li>portability: irrespective of the underlying operating system (and system call API), the API is the same</li><li>extensive features: string management, I/O formatting</li><li>possibility of increased efficiency with techniques such as buffering, as we show later</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="analyzing-the-software-stack">Analyzing the Software Stack<a class="hash-link" href="#analyzing-the-software-stack" title="Direct link to heading">​</a></h2><p>To get a better grasp on how the software stack works, let&#x27;s do a bottom-up approach:
we build and run different programs, that start off by using the system call API (the lowest layer in the software stack) and progressively use higher layers.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="system-calls-explained">System Calls Explained<a class="hash-link" href="#system-calls-explained" title="Direct link to heading">​</a></h3><p>A system call, or syscall for short, is a method used by applications to communicate with the operating system&#x27;s kernel.</p><p>The need for syscalls is tied to the modern operating systems model of conceptually separating into kernel space and user space.</p><p>The kernel space manages the hardware resources such as CPU, I/O devices, disk or memory.
Moreover, the kernel also provides an interface for the user space applications to interact with the hardware.</p><p>The user space is where you are running your applications and processes.
From the user space, we cannot directly access the hardware or perform privileged operations.
You need to use syscalls to perform privileged operations such as accessing the hardware.</p><p>Below, you can see some examples of system calls and what resource they request from the kernel:</p><ul><li><code>brk()</code> is used to allocate memory</li><li><code>open()</code> is used to access the file system and open a specific file</li><li><code>write()</code> is used to access the file system and modify the contents of a specific file</li></ul><p><img loading="lazy" alt="System Call API Explained" src="/operating-systems/169/assets/images/syscall-explained-ff8f5182d632fa4fcf77ffd5f5fe958c.svg" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="basic-system-calls">Basic System Calls<a class="hash-link" href="#basic-system-calls" title="Direct link to heading">​</a></h3><p>The <code>basic-syscall/support/</code> folder stores the implementation of a simple program in assembly language for the x86_64 (64 bit) architecture.
The program invokes two system calls: <code>write</code> and <code>exit</code>.
The program is duplicated in two files using the two x86 assembly language syntaxes: the Intel / NASM syntax (<code>hello.asm</code>) and the AT&amp;T / GAS syntax (<code>hello.s</code>).</p><p>The implementation follows the <a href="https://x64.syscall.sh/" target="_blank" rel="noopener noreferrer">x86_64 Linux calling convention</a>:</p><ul><li>system call ID is passed in the <code>rax</code> register</li><li>system call arguments are passed, in order, in the <code>rdi</code>, <code>rsi</code>, <code>rdx</code>, <code>r10</code>, <code>r8</code>, <code>r9</code> registers</li></ul><p>Let&#x27;s build and run the two programs:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../basic-syscall/support$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello.asm  hello.s  Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../basic-syscall/support$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nasm -f elf64 -o hello-nasm.o hello.asm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc -nostdlib -no-pie -Wl,--entry=main -Wl,--build-id=none  hello-nasm.o   -o hello-nasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc -c -o hello-gas.o hello.s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc -nostdlib -no-pie -Wl,--entry=main -Wl,--build-id=none  hello-gas.o   -o hello-gas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../basic-syscall/support$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello.asm  hello-gas  hello-gas.o  hello-nasm  hello-nasm.o  hello.s  Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../basic-syscall/support$ ./hello-nasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello, world!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../basic-syscall/support$ ./hello-gas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello, world!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The two programs end up printing the <code>Hello, world!</code> message at standard output by issuing the <code>write</code> system call.
Then they complete their work by issuing the <code>exit</code> system call.</p><p>The <code>write</code> system call writes a buffer to the file referred by the first argument, which is the file descriptor.
File descriptors are going to be studied in-depth in future chapters.
For now, it is enough for you to know that they are integers that behave like file handlers.
The 3 most common file descriptors are:</p><ul><li><p><code>0</code> references the standard input (<code>stdin</code>)</p></li><li><p><code>1</code> references the standard output (<code>stdout</code>)</p></li><li><p><code>2</code> references the standard error (<code>stderr</code>)</p></li></ul><p>Use <code>man 2 write</code> and <code>man 3 exit</code> to get a detailed understanding of the syntax and use of the two system calls.
You can also check the online man pages: <a href="https://man7.org/linux/man-pages/man2/write.2.html" target="_blank" rel="noopener noreferrer"><code>write</code></a>, <a href="https://man7.org/linux/man-pages/man3/exit.3.html" target="_blank" rel="noopener noreferrer"><code>exit</code></a></p><p>We use <code>strace</code> to inspect system calls issued by a program:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../basic-syscall/support$ strace ./hello-nasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">execve(&quot;./hello-nasm&quot;, [&quot;./hello-nasm&quot;], 0x7ffc4e175f00 /- 63 vars */) = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write(1, &quot;Hello, world!\n&quot;, 14Hello, world!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)         = 14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit(0)                                 = ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+++ exited with 0 +++</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are three system calls captured by <code>strace</code>:</p><ul><li><code>execve()</code>: this is issued by the shell to create the new process;
you&#x27;ll find out more about <code>execve</code> in the &quot;Compute&quot; chapter</li><li><code>write()</code>: called by the program to print <code>Hello, world!</code> to standard output</li><li><code>exit()</code>: to exit the program</li></ul><p>This is the most basic program for doing system calls.
Given that system calls require a specific calling convention, their invocation can only be done in assembly language.
Obviously, this is not portable (specific to a given CPU architecture, x86_64 in our case) and too verbose and difficult to maintain.
For portability and maintainability, we require a higher level language, such as C.
In order to use C, we need function wrappers around system calls.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-call-wrappers">System Call Wrappers<a class="hash-link" href="#system-call-wrappers" title="Direct link to heading">​</a></h2><p>The <code>syscall-wrapper/support/</code> folder stores the implementation of a simple program written in C (<code>main.c</code>) that calls the <code>write()</code> and <code>exit()</code> functions.
The functions are defined in <code>syscall.asm</code> as wrappers around corresponding system calls.
Each function invokes the corresponding system call using the specific system call ID and the arguments provided for the function call.</p><p>The implementation of the two wrapper functions in <code>syscall.asm</code> is very simple, as the function arguments are passed in the same registers required by the system call.
This is because of the overlap of the first three registers for the <a href="https://en.wikipedia.org/wiki/X86_calling_conventions#System_V_AMD64_ABI" target="_blank" rel="noopener noreferrer">x86_64 Linux function calling convention</a> and the <a href="https://x64.syscall.sh/" target="_blank" rel="noopener noreferrer">x86_64 Linux system call convention</a>.</p><p><code>syscall.h</code> contains the declaration of the two functions and is included in <code>main.c</code>.
This way, C programs can be written that make function calls that end up making system calls.</p><p>Let&#x27;s build, run and trace system calls for the program:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../syscall-wrapper/support$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main.c  Makefile  syscall.h  syscall.s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../syscall-wrapper/support$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc -c -o main.o main.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nasm -f elf64 -o syscall.o syscall.s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc -nostdlib -no-pie -Wl,--entry=main -Wl,--build-id=none  main.o syscall.o   -o main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../syscall-wrapper/support$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main  main.c  main.o  Makefile  syscall.h  syscall.o  syscall.s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../software-stack/lab/syscall-wrapper$ ./main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello, world!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../syscall-wrapper/support$ strace ./main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">execve(&quot;./main&quot;, [&quot;./main&quot;], 0x7ffee60fb590 /- 63 vars */) = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write(1, &quot;Hello, world!\n&quot;, 14Hello, world!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)         = 14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit(0)                                 = ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+++ exited with 0 +++</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The trace is similar to the previous example, showing the <code>write()</code> and <code>exit()</code> system calls.</p><p>By creating system call wrappers as C functions, we are now relieved of the burden of writing assembly language code.
Of course, there has to be an initial implementation of wrapper functions written in assembly language;
but, after that, we can use C only.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="library-calls-vs-system-calls">Library calls vs System Calls<a class="hash-link" href="#library-calls-vs-system-calls" title="Direct link to heading">​</a></h2><p>The standard C library has primarily two uses:</p><ol><li>wrapping system calls into easier to use C-style library calls, such as <code>open()</code>, <code>write()</code>, <code>read()</code></li><li>adding common functionality required for our program, such as string management (<code>strcpy</code>), memory management (<code>malloc()</code>) or formatted I/O (<code>printf()</code>)</li></ol><p>The first use means a 1-to-1 mapping between library calls and system calls: one library call means one system call.
The second group doesn&#x27;t have a standard mapping.
A library call could be mapped to no system calls, one system call, two or more system calls, or it may depend (a system call may or may not happen).</p><p>The <code>libcall-syscall/support</code> folder stores the implementation of a simple program that makes different library calls.
Let&#x27;s build the program and then trace the library calls (with <code>ltrace</code>) and the system calls (with <code>strace</code>):</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../libcall-syscall/support$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc -Wall   -c -o call.o call.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc   call.o   -o call</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc -Wall   -c -o call2.o call2.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc   call2.o   -o call2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../libcall-syscall/support$ ltrace ./call</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fopen(&quot;a.txt&quot;, &quot;wt&quot;)                                                                                             = 0x556d57679260</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">strlen(&quot;Hello, world!\n&quot;)                                                                                        = 14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fwrite(&quot;Hello, world!\n&quot;, 1, 14, 0x556d57679260)                                                                 = 14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">strlen(&quot;Bye, world!\n&quot;)                                                                                          = 12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fwrite(&quot;Bye, world!\n&quot;, 1, 12, 0x556d57679260)                                                                   = 12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fflush(0x556d57679260)                                                                                           = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+++ exited (status 0) +++</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~/.../libcall-syscall/support$ strace ./call</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openat(AT_FDCWD, &quot;a.txt&quot;, O_WRONLY|O_CREAT|O_TRUNC, 0666) = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fstat(3, {st_mode=S_IFREG|0664, st_size=0, ...}) = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write(3, &quot;Hello, world!\nBye, world!\n&quot;, 26) = 26</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exit_group(0)                           = ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+++ exited with 0 +++</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We have the following mappings:</p><ul><li>The <code>fopen()</code> library call invokes the <code>openat</code> and the <code>fstat</code> system calls.</li><li>The <code>fwrite()</code> library call invokes no system calls.</li><li>The <code>strlen()</code> library call invokes no system calls.</li><li>The <code>fflush()</code> library call invokes the <code>write</code> system call.</li></ul><p>This all seems to make sense.
The main reason for <code>fwrite()</code> not making any system calls is the use of a standard C library buffer.
Calls the <code>fwrite()</code> end up writing to that buffer to reduce the number of system calls.
Actual system calls are made either when the standard C library buffer is full or when an <code>fflush()</code> library call is made.</p><p>Note that on some systems, <code>ltrace</code> <strong>does not work*- as expected, due to </strong>now binding<strong>.
To avoid this behaviour, you can force the </strong>lazy binding<em>- (based on which <code>ltrace</code> is constructed to work).
An example can be found in <code>libcall-syscall/support/Makefile</code>, however for system binaries, such as <code>ls</code> or <code>pwd</code>, the only alternative is to add the `-x &quot;</em>&quot;` argument to force the command to trace all symbols in the symbol table:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~$ ltrace -x &quot;*&quot; ls</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can always choose what library functions <code>ltrace</code> is investigating, by replacing the wildcard with their name:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">student@os:~$ ltrace -x &quot;malloc&quot; -x &quot;free&quot; ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malloc@libc.so.6(5)                                                    = 0x55c42b2b8910</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">free@libc.so.6(0x55c42b2b8910)                                         = &lt;void&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malloc@libc.so.6(120)                                                  = 0x55c42b2b8480</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malloc@libc.so.6(12)                                                   = 0x55c42b2b8910</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malloc@libc.so.6(776)                                                  = 0x55c42b2b8930</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malloc@libc.so.6(112)                                                  = 0x55c42b2b8c40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malloc@libc.so.6(1336)                                                 = 0x55c42b2b8cc0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malloc@libc.so.6(216)                                                  = 0x55c42b2b9200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malloc@libc.so.6(432)                                                  = 0x55c42b2b92e0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malloc@libc.so.6(104)                                                  = 0x55c42b2b94a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malloc@libc.so.6(88)                                                   = 0x55c42b2b9510</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">malloc@libc.so.6(120)                                                  = 0x55c42b2b9570</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[...]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you would like to know more about <strong>lazy binding</strong>, <strong>now binding*- or </strong>PLT*- entries, check out <a href="https://maskray.me/blog/2021-09-19-all-about-procedure-linkage-table" target="_blank" rel="noopener noreferrer">this blog post</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/operating-systems/169/Software Stack/Questions/strcpy-syscall"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">strcpy() System Call</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/operating-systems/169/Software Stack/lab2"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lab 2 - Library Perspective</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#task-system-calls" class="table-of-contents__link toc-highlight">Task: System Calls</a></li><li><a href="#task-system-call-wrappers" class="table-of-contents__link toc-highlight">Task: System Call Wrappers</a></li><li><a href="#task-library-calls-vs-system-calls" class="table-of-contents__link toc-highlight">Task: Library Calls vs System Calls</a></li><li><a href="#modern-software-stacks" class="table-of-contents__link toc-highlight">Modern Software Stacks</a></li><li><a href="#analyzing-the-software-stack" class="table-of-contents__link toc-highlight">Analyzing the Software Stack</a><ul><li><a href="#system-calls-explained" class="table-of-contents__link toc-highlight">System Calls Explained</a></li><li><a href="#basic-system-calls" class="table-of-contents__link toc-highlight">Basic System Calls</a></li></ul></li><li><a href="#system-call-wrappers" class="table-of-contents__link toc-highlight">System Call Wrappers</a></li><li><a href="#library-calls-vs-system-calls" class="table-of-contents__link toc-highlight">Library calls vs System Calls</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://curs.upb.ro" target="_blank" rel="noopener noreferrer" class="footer__link-item">Main site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ocw.cs.pub.ro/courses/so" target="_blank" rel="noopener noreferrer" class="footer__link-item">OCW<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/sisteme.de.operare/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 SO Team</div></div></div></footer></div>
<script src="/operating-systems/169/assets/js/runtime~main.78364b44.js"></script>
<script src="/operating-systems/169/assets/js/main.a92f4421.js"></script>
</body>
</html>